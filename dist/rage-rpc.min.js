!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports=r():e.rpc=r()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};e.r(r),e.d(r,{call:()=>P,callBrowser:()=>S,callBrowsers:()=>C,callClient:()=>R,callServer:()=>j,default:()=>U,off:()=>M,on:()=>L,register:()=>v,trigger:()=>N,triggerBrowser:()=>q,triggerBrowsers:()=>V,triggerClient:()=>T,triggerServer:()=>J,unregister:()=>b});var t=function(e){return e.Blip="b",e.Checkpoint="cp",e.Colshape="c",e.Label="l",e.Marker="m",e.Object="o",e.Pickup="p",e.Player="pl",e.Vehicle="v",e}(t||{});function n(e,r){try{const n="client"===c();if(e&&"object"==typeof e&&void 0!==e.id){const o=(r,t,o)=>n?e.type===r&&t.at(e.id)===e:e instanceof o;switch(r){case t.Blip:return o("blip",mp.blips,mp.Blip);case t.Checkpoint:return o("checkpoint",mp.checkpoints,mp.Checkpoint);case t.Colshape:return o("colshape",mp.colshapes,mp.Colshape);case t.Label:return o("textlabel",mp.labels,mp.TextLabel);case t.Marker:return o("marker",mp.markers,mp.Marker);case t.Object:return o("object",mp.objects,mp.Object);case t.Pickup:return o("pickup",mp.pickups,mp.Pickup);case t.Player:return o("player",mp.players,mp.Player);case t.Vehicle:return o("vehicle",mp.vehicles,mp.Vehicle)}}return!1}catch(e){}}function o(){try{const e=46656*Math.random()|0,r=46656*Math.random()|0;return("000"+e.toString(36)).slice(-3)+("000"+r.toString(36)).slice(-3)}catch(e){}}function c(){try{if("undefined"==typeof mp)return"react";if(mp.joaat)return"server";if(mp.game&&mp.game.joaat)return"client";if(mp.trigger)return"cef"}catch(e){}}function s(e){try{const r=c();return JSON.stringify(e,((e,o)=>{if("client"===r||"server"===r&&o&&"object"==typeof o){let e;if(n(o,t.Blip)?e=t.Blip:n(o,t.Checkpoint)?e=t.Checkpoint:n(o,t.Colshape)?e=t.Colshape:n(o,t.Marker)?e=t.Marker:n(o,t.Object)?e=t.Object:n(o,t.Pickup)?e=t.Pickup:n(o,t.Player)?e=t.Player:n(o,t.Vehicle)&&(e=t.Vehicle),e)return{__t:e,i:"number"==typeof o.remoteId?o.remoteId:o.id}}return o}))}catch(e){}}function i(e,r){try{return"number"==typeof r?Promise.race([new Promise(((e,t)=>{setTimeout((()=>t("TIMEOUT")),r)})),e]):e}catch(e){}}function a(e){try{e.url}catch(e){return!1}return!0}const l=c();if(!l)throw"Unknown RAGE environment";const p="PROCEDURE_NOT_FOUND",g="__rpc:id",m="__rpc:process",u="__rpc:browserRegister",f="__rpc:browserUnregister",h="__rpc:triggerEvent",d="__rpc:triggerEventBrowsers",_="cef"===l||"react"===l?window:e.g;if(!_[m])try{if(_.__rpcListeners={},_.__rpcPending={},_.__rpcEvListeners={},_[m]=(e,r)=>{"server"!==l&&(r=e);const n=function(e){try{const r=c();return JSON.parse(e,((e,n)=>{if(("client"===r||"server"===r)&&n&&"object"==typeof n&&"string"==typeof n.__t&&"number"==typeof n.i&&2===Object.keys(n).length){const e=n.i;let o;switch(n.__t){case t.Blip:o=mp.blips;break;case t.Checkpoint:o=mp.checkpoints;break;case t.Colshape:o=mp.colshapes;break;case t.Label:o=mp.labels;break;case t.Marker:o=mp.markers;break;case t.Object:o=mp.objects;break;case t.Pickup:o=mp.pickups;break;case t.Player:o=mp.players;break;case t.Vehicle:o=mp.vehicles}if(o)return o["client"===r?"atRemoteId":"at"](e)}return n}))}catch(e){}}(r);if(n.req){const r={id:n.id,environment:n.fenv||n.env};"server"===l&&(r.player=e);const t={ret:1,id:n.id,env:l};let o;switch(l){case"server":o=e=>r.player.call(m,[s(e)]);break;case"client":if("server"===n.env)o=e=>mp.events.callRemote(m,s(e));else if("cef"===n.env){const e=n.b&&_.__rpcBrowsers[n.b];r.browser=e,o=r=>e&&a(e)&&w(e,r,!0)}break;case"cef":o=e=>mp.trigger(m,s(e))}if(o){const e=y(n.name,n.args,r);n.noRet||e.then((e=>o({...t,res:e}))).catch((e=>o({...t,err:e||null})))}}else if(n.ret){const r=_.__rpcPending[n.id];if("server"===l&&r.player!==e)return;r&&(r.resolve(n.hasOwnProperty("err")?Promise.reject(n.err):Promise.resolve(n.res)),delete _.__rpcPending[n.id])}},"cef"!==l&&"react"!==l){if(mp.events.add(m,_[m]),"client"===l){v("__rpc:callServer",(([e,r,t],n)=>k(e,r,{fenv:n.environment,noRet:t}))),v("__rpc:callBrowsers",(([e,r,t],n)=>O(null,e,r,{fenv:n.environment,noRet:t}))),_.__rpcBrowsers={};const e=e=>{const r=o();Object.keys(_.__rpcBrowsers).forEach((r=>{const t=_.__rpcBrowsers[r];t&&a(t)&&t!==e||delete _.__rpcBrowsers[r]})),_.__rpcBrowsers[r]=e,e.execute(`\n                    window.name = '${r}';\n                    if(typeof window['__rpc:id'] === 'undefined'){\n                        window['__rpc:id'] = Promise.resolve(window.name);\n                    }else{\n                        window['__rpc:id:resolve'](window.name);\n                    }\n                `)};mp.browsers.forEach(e),mp.events.add("browserCreated",e),_.__rpcBrowserProcedures={},mp.events.add(u,(e=>{const[r,t]=JSON.parse(e);_.__rpcBrowserProcedures[t]=r})),mp.events.add(f,(e=>{const[r,t]=JSON.parse(e);_.__rpcBrowserProcedures[t]===r&&delete _.__rpcBrowserProcedures[t]})),v(d,(([e,r],t)=>{Object.keys(_.__rpcBrowsers).forEach((n=>{const o=_.__rpcBrowsers[n];o&&a(o)?x(o,h,[e,r],{fenv:t.environment,noRet:1}):delete _.__rpcBrowsers[n]}))}))}}else void 0===_[g]&&(_[g]=new Promise((e=>{window.name?e(window.name):_["__rpc:id:resolve"]=e})));v(h,(([e,r],t)=>E(e,r,t)))}catch(e){}function w(e,r,t){try{const n=s(r);e.execute(`var process = window["__rpc:process"]; if(process){ process(${JSON.stringify(n)}); }else{ ${t?"":`mp.trigger("__rpc:process", '{"ret":1,"id":"${r.id}","err":"${p}","env":"cef"}');`} }`)}catch(e){}}function y(e,r,t){try{const n=_.__rpcListeners[e];return n?Promise.resolve(n(r,t)):Promise.reject(p)}catch(e){}}function v(e,r){try{if(2!==arguments.length)throw'register expects 2 arguments: "name" and "cb"';return"cef"===l&&_[g].then((r=>mp.trigger(u,JSON.stringify([r,e])))),_.__rpcListeners[e]=r,()=>b(e)}catch(e){}}function b(e){try{if(1!==arguments.length)throw'unregister expects 1 argument: "name"';"cef"===l&&_[g].then((r=>mp.trigger(f,JSON.stringify([r,e])))),_.__rpcListeners[e]=void 0}catch(e){}}function P(e,r,t={}){try{return arguments.length<1||arguments.length>3?Promise.reject('call expects 1 to 3 arguments: "name", optional "args", and optional "options"'):i(y(e,r,{environment:l}),t.timeout)}catch(e){}}function k(e,r,t={}){try{switch(l){case"server":return P(e,r);case"client":{const n=o();return new Promise((o=>{t.noRet||(_.__rpcPending[n]={resolve:o});const c={req:1,id:n,name:e,env:l,args:r,...t};mp.events.callRemote(m,s(c))}))}case"cef":return R("__rpc:callServer",[e,r,+t.noRet])}}catch(e){}}function j(e,r,t={}){try{if(arguments.length<1||arguments.length>3)return Promise.reject('callServer expects 1 to 3 arguments: "name", optional "args", and optional "options"');let n={};return t.noRet&&(n.noRet=1),i(k(e,r,n),t.timeout)}catch(e){}}function B(e,r,t,n={}){try{switch(l){case"client":return P(r,t);case"server":{const c=o();return new Promise((o=>{n.noRet||(_.__rpcPending[c]={resolve:o,player:e});const i={req:1,id:c,name:r,env:l,args:t,...n};e.call(m,[s(i)])}))}case"cef":{const e=o();return _[g].then((o=>new Promise((c=>{n.noRet||(_.__rpcPending[e]={resolve:c});const i={b:o,req:1,id:e,name:r,env:l,args:t,...n};mp.trigger(m,s(i))}))))}}}catch(e){}}function R(e,r,t,n={}){try{switch(l){case"client":if(n=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return Promise.reject('callClient from the client expects 1 to 3 arguments: "name", optional "args", and optional "options"');break;case"server":if(arguments.length<2||arguments.length>4||"object"!=typeof e)return Promise.reject('callClient from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');break;case"cef":if(n=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return Promise.reject('callClient from the browser expects 1 to 3 arguments: "name", optional "args", and optional "options"')}let o={};return n.noRet&&(o.noRet=1),i(B(e,r,t,o),n.timeout)}catch(e){}}function x(e,r,t,n={}){try{return new Promise((c=>{const s=o();n.noRet||(_.__rpcPending[s]={resolve:c}),w(e,{req:1,id:s,name:r,env:l,args:t,...n},!1)}))}catch(e){}}function O(e,r,t,n={}){try{switch(l){case"client":const o=_.__rpcBrowserProcedures[r];if(!o)return Promise.reject(p);const c=_.__rpcBrowsers[o];return c&&a(c)?x(c,r,t,n):Promise.reject(p);case"server":return B(e,"__rpc:callBrowsers",[r,t,+n.noRet],n);case"cef":return B(null,"__rpc:callBrowsers",[r,t,+n.noRet],n)}}catch(e){}}function C(e,r,t,n={}){try{let o,c={};switch(l){case"client":case"cef":if(n=t||{},t=r,r=e,arguments.length<1||arguments.length>3)return Promise.reject('callBrowsers from the client or browser expects 1 to 3 arguments: "name", optional "args", and optional "options"');n.noRet&&(c.noRet=1),o=O(null,r,t,c);break;case"server":if(arguments.length<2||arguments.length>4)return Promise.reject('callBrowsers from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');n.noRet&&(c.noRet=1),o=O(e,r,t,c)}if(o)return i(o,n.timeout)}catch(e){}}function S(e,r,t,n={}){try{if("client"!==l)return Promise.reject("callBrowser can only be used in the client environment");if(arguments.length<2||arguments.length>4)return Promise.reject('callBrowser expects 2 to 4 arguments: "browser", "name", optional "args", and optional "options"');let o={};return n.noRet&&(o.noRet=1),i(x(e,r,t,o),n.timeout)}catch(e){}}function E(e,r,t){try{const n=_.__rpcEvListeners[e];n&&n.forEach((e=>e(r,t)))}catch(e){}}function L(e,r){try{if(2!==arguments.length)throw'on expects 2 arguments: "name" and "cb"';const t=_.__rpcEvListeners[e]||new Set;return t.add(r),_.__rpcEvListeners[e]=t,()=>M(e,r)}catch(e){}}function M(e,r){try{if(2!==arguments.length)throw'off expects 2 arguments: "name" and "cb"';const t=_.__rpcEvListeners[e];t&&t.delete(r)}catch(e){}}function N(e,r){try{if(arguments.length<1||arguments.length>2)throw'trigger expects 1 or 2 arguments: "name", and optional "args"';E(e,r,{environment:l})}catch(e){}}function T(e,r,t){try{switch(l){case"client":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the client expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3||"object"!=typeof e)throw'triggerClient from the server expects 2 or 3 arguments: "player", "name", and optional "args"';break;case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the browser expects 1 or 2 arguments: "name", and optional "args"'}B(e,h,[r,t],{noRet:1})}catch(e){}}function J(e,r){try{if(arguments.length<1||arguments.length>2)throw'triggerServer expects 1 or 2 arguments: "name", and optional "args"';k(h,[e,r],{noRet:1})}catch(e){}}function V(e,r,t){try{switch(l){case"client":case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2)throw'triggerBrowsers from the client or browser expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3)throw'triggerBrowsers from the server expects 2 or 3 arguments: "player", "name", and optional "args"'}B(e,d,[r,t],{noRet:1})}catch(e){}}function q(e,r,t){try{if("client"!==l)throw"callBrowser can only be used in the client environment";if(arguments.length<2||arguments.length>4)throw'callBrowser expects 2 or 3 arguments: "browser", "name", and optional "args"';x(e,h,[r,t],{noRet:1})}catch(e){}}const U={register:v,unregister:b,call:P,callServer:j,callClient:R,callBrowsers:C,callBrowser:S,on:L,off:M,trigger:N,triggerServer:J,triggerClient:T,triggerBrowsers:V,triggerBrowser:q};return r})()));