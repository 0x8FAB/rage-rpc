!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports=r():e.rpc=r()}("undefined"!=typeof self?self:this,(function(){return(()=>{"use strict";var e={d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r,t={};e.r(t),e.d(t,{call:()=>P,callBrowser:()=>L,callBrowsers:()=>E,callClient:()=>O,callServer:()=>j,default:()=>I,off:()=>N,on:()=>T,register:()=>k,trigger:()=>$,triggerBrowser:()=>U,triggerBrowsers:()=>q,triggerClient:()=>J,triggerServer:()=>V,unregister:()=>B}),function(e){e.Blip="b",e.Checkpoint="cp",e.Colshape="c",e.Label="l",e.Marker="m",e.Object="o",e.Pickup="p",e.Player="pl",e.Vehicle="v"}(r||(r={}));function n(e,t){try{const n="client"===o();if(e&&"object"==typeof e&&void 0!==e.id){const c=(r,t,c)=>n?e.type===r&&t.at(e.id)===e:e instanceof c;switch(t){case r.Blip:return c("blip",mp.blips,mp.Blip);case r.Checkpoint:return c("checkpoint",mp.checkpoints,mp.Checkpoint);case r.Colshape:return c("colshape",mp.colshapes,mp.Colshape);case r.Label:return c("textlabel",mp.labels,mp.TextLabel);case r.Marker:return c("marker",mp.markers,mp.Marker);case r.Object:return c("object",mp.objects,mp.Object);case r.Pickup:return c("pickup",mp.pickups,mp.Pickup);case r.Player:return c("player",mp.players,mp.Player);case r.Vehicle:return c("vehicle",mp.vehicles,mp.Vehicle)}}return!1}catch(e){}}function c(){try{const e=46656*Math.random()|0,r=46656*Math.random()|0;return("000"+e.toString(36)).slice(-3)+("000"+r.toString(36)).slice(-3)}catch(e){}}function o(){try{if(mp.joaat)return"server";if(mp.game&&mp.game.joaat)return"client";if(mp.trigger)return"cef"}catch(e){}}function s(e){try{const t=o();return JSON.stringify(e,((e,c)=>{if("client"===t||"server"===t&&c&&"object"==typeof c){let e;if(n(c,r.Blip)?e=r.Blip:n(c,r.Checkpoint)?e=r.Checkpoint:n(c,r.Colshape)?e=r.Colshape:n(c,r.Marker)?e=r.Marker:n(c,r.Object)?e=r.Object:n(c,r.Pickup)?e=r.Pickup:n(c,r.Player)?e=r.Player:n(c,r.Vehicle)&&(e=r.Vehicle),e)return{__t:e,i:"number"==typeof c.remoteId?c.remoteId:c.id}}return c}))}catch(e){}}function i(e){try{return new Promise((r=>setTimeout((()=>r(e)),0)))}catch(e){}}function a(e){try{return new Promise(((r,t)=>setTimeout((()=>t(e)),0)))}catch(e){}}function l(e,r){try{return"number"==typeof r?Promise.race([new Promise(((e,t)=>{setTimeout((()=>t("TIMEOUT")),r)})),e]):e}catch(e){}}function p(e){try{e.url}catch(e){return!1}return!0}const u=o();if(!u)throw"Unknown RAGE environment";const g="PROCEDURE_NOT_FOUND",f="__rpc:id",m="__rpc:process",h="__rpc:browserRegister",d="__rpc:browserUnregister",w="__rpc:triggerEvent",_="__rpc:triggerEventBrowsers",y="cef"===u?window:e.g;if(!y[m])try{if(y.__rpcListeners={},y.__rpcPending={},y.__rpcEvListeners={},y[m]=(e,t)=>{"server"!==u&&(t=e);const n=function(e){try{const t=o();return JSON.parse(e,((e,n)=>{if(("client"===t||"server"===t)&&n&&"object"==typeof n&&"string"==typeof n.__t&&"number"==typeof n.i&&2===Object.keys(n).length){const e=n.i;let c;switch(n.__t){case r.Blip:c=mp.blips;break;case r.Checkpoint:c=mp.checkpoints;break;case r.Colshape:c=mp.colshapes;break;case r.Label:c=mp.labels;break;case r.Marker:c=mp.markers;break;case r.Object:c=mp.objects;break;case r.Pickup:c=mp.pickups;break;case r.Player:c=mp.players;break;case r.Vehicle:c=mp.vehicles}if(c)return c["client"===t?"atRemoteId":"at"](e)}return n}))}catch(e){}}(t);if(n.req){const r={id:n.id,environment:n.fenv||n.env};"server"===u&&(r.player=e);const t={ret:1,id:n.id,env:u};let c;switch(u){case"server":c=e=>r.player.call(m,[s(e)]);break;case"client":if("server"===n.env)c=e=>mp.events.callRemote(m,s(e));else if("cef"===n.env){const e=n.b&&y.__rpcBrowsers[n.b];r.browser=e,c=r=>e&&p(e)&&v(e,r,!0)}break;case"cef":c=e=>mp.trigger(m,s(e))}if(c){const e=b(n.name,n.args,r);n.noRet||e.then((e=>c({...t,res:e}))).catch((e=>c({...t,err:e||null})))}}else if(n.ret){const r=y.__rpcPending[n.id];if("server"===u&&r.player!==e)return;r&&(r.resolve(n.hasOwnProperty("err")?a(n.err):i(n.res)),delete y.__rpcPending[n.id])}},"cef"!==u){if(mp.events.add(m,y[m]),"client"===u){k("__rpc:callServer",(([e,r,t],n)=>R(e,r,{fenv:n.environment,noRet:t}))),k("__rpc:callBrowsers",(([e,r,t],n)=>S(null,e,r,{fenv:n.environment,noRet:t}))),y.__rpcBrowsers={};const e=e=>{const r=c();Object.keys(y.__rpcBrowsers).forEach((r=>{const t=y.__rpcBrowsers[r];t&&p(t)&&t!==e||delete y.__rpcBrowsers[r]})),y.__rpcBrowsers[r]=e,e.execute(`\n                    window.name = '${r}';\n                    if(typeof window['__rpc:id'] === 'undefined'){\n                        window['__rpc:id'] = Promise.resolve(window.name);\n                    }else{\n                        window['__rpc:id:resolve'](window.name);\n                    }\n                `)};mp.browsers.forEach(e),mp.events.add("browserCreated",e),y.__rpcBrowserProcedures={},mp.events.add(h,(e=>{const[r,t]=JSON.parse(e);y.__rpcBrowserProcedures[t]=r})),mp.events.add(d,(e=>{const[r,t]=JSON.parse(e);y.__rpcBrowserProcedures[t]===r&&delete y.__rpcBrowserProcedures[t]})),k(_,(([e,r],t)=>{Object.keys(y.__rpcBrowsers).forEach((n=>{const c=y.__rpcBrowsers[n];c&&p(c)?C(c,w,[e,r],{fenv:t.environment,noRet:1}):delete y.__rpcBrowsers[n]}))}))}}else void 0===y[f]&&(y[f]=new Promise((e=>{window.name?e(window.name):y["__rpc:id:resolve"]=e})));k(w,(([e,r],t)=>M(e,r,t)))}catch(e){}function v(e,r,t){try{const n=s(r);e.execute(`var process = window["__rpc:process"]; if(process){ process(${JSON.stringify(n)}); }else{ ${t?"":`mp.trigger("__rpc:process", '{"ret":1,"id":"${r.id}","err":"${g}","env":"cef"}');`} }`)}catch(e){}}function b(e,r,t){try{const n=y.__rpcListeners[e];return n?i(n(r,t)):a(`${g} (${e})`)}catch(e){}}function k(e,r){try{if(2!==arguments.length)throw'register expects 2 arguments: "name" and "cb"';return"cef"===u&&y[f].then((r=>mp.trigger(h,JSON.stringify([r,e])))),y.__rpcListeners[e]=r,()=>B(e)}catch(e){}}function B(e){try{if(1!==arguments.length)throw'unregister expects 1 argument: "name"';"cef"===u&&y[f].then((r=>mp.trigger(d,JSON.stringify([r,e])))),y.__rpcListeners[e]=void 0}catch(e){}}function P(e,r,t={}){try{return arguments.length<1||arguments.length>3?a('call expects 1 to 3 arguments: "name", optional "args", and optional "options"'):l(b(e,r,{environment:u}),t.timeout)}catch(e){}}function R(e,r,t={}){try{switch(u){case"server":return P(e,r);case"client":{const n=c();return new Promise((c=>{t.noRet||(y.__rpcPending[n]={resolve:c});const o={req:1,id:n,name:e,env:u,args:r,...t};mp.events.callRemote(m,s(o))}))}case"cef":return O("__rpc:callServer",[e,r,+t.noRet])}}catch(e){}}function j(e,r,t={}){try{if(arguments.length<1||arguments.length>3)return a('callServer expects 1 to 3 arguments: "name", optional "args", and optional "options"');let n={};return t.noRet&&(n.noRet=1),l(R(e,r,n),t.timeout)}catch(e){}}function x(e,r,t,n={}){try{switch(u){case"client":return P(r,t);case"server":{const o=c();return new Promise((c=>{n.noRet||(y.__rpcPending[o]={resolve:c,player:e});const i={req:1,id:o,name:r,env:u,args:t,...n};e.call(m,[s(i)])}))}case"cef":{const e=c();return y[f].then((c=>new Promise((o=>{n.noRet||(y.__rpcPending[e]={resolve:o});const i={b:c,req:1,id:e,name:r,env:u,args:t,...n};mp.trigger(m,s(i))}))))}}}catch(e){}}function O(e,r,t,n={}){try{switch(u){case"client":if(n=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return a('callClient from the client expects 1 to 3 arguments: "name", optional "args", and optional "options"');break;case"server":if(arguments.length<2||arguments.length>4||"object"!=typeof e)return a('callClient from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');break;case"cef":if(n=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return a('callClient from the browser expects 1 to 3 arguments: "name", optional "args", and optional "options"')}let c={};return n.noRet&&(c.noRet=1),l(x(e,r,t,c),n.timeout)}catch(e){}}function C(e,r,t,n={}){try{return new Promise((o=>{const s=c();n.noRet||(y.__rpcPending[s]={resolve:o}),v(e,{req:1,id:s,name:r,env:u,args:t,...n},!1)}))}catch(e){}}function S(e,r,t,n={}){try{switch(u){case"client":const c=y.__rpcBrowserProcedures[r];if(!c)return a(`${g} (${r})`);const o=y.__rpcBrowsers[c];return o&&p(o)?C(o,r,t,n):a(g);case"server":return x(e,"__rpc:callBrowsers",[r,t,+n.noRet],n);case"cef":return x(null,"__rpc:callBrowsers",[r,t,+n.noRet],n)}}catch(e){}}function E(e,r,t,n={}){try{let c,o={};switch(u){case"client":case"cef":if(n=t||{},t=r,r=e,arguments.length<1||arguments.length>3)return a('callBrowsers from the client or browser expects 1 to 3 arguments: "name", optional "args", and optional "options"');n.noRet&&(o.noRet=1),c=S(null,r,t,o);break;case"server":if(arguments.length<2||arguments.length>4)return a('callBrowsers from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');n.noRet&&(o.noRet=1),c=S(e,r,t,o)}if(c)return l(c,n.timeout)}catch(e){}}function L(e,r,t,n={}){try{if("client"!==u)return a("callBrowser can only be used in the client environment");if(arguments.length<2||arguments.length>4)return a('callBrowser expects 2 to 4 arguments: "browser", "name", optional "args", and optional "options"');let c={};return n.noRet&&(c.noRet=1),l(C(e,r,t,c),n.timeout)}catch(e){}}function M(e,r,t){try{const n=y.__rpcEvListeners[e];n&&n.forEach((e=>e(r,t)))}catch(e){}}function T(e,r){try{if(2!==arguments.length)throw'on expects 2 arguments: "name" and "cb"';const t=y.__rpcEvListeners[e]||new Set;return t.add(r),y.__rpcEvListeners[e]=t,()=>N(e,r)}catch(e){}}function N(e,r){try{if(2!==arguments.length)throw'off expects 2 arguments: "name" and "cb"';const t=y.__rpcEvListeners[e];t&&t.delete(r)}catch(e){}}function $(e,r){try{if(arguments.length<1||arguments.length>2)throw'trigger expects 1 or 2 arguments: "name", and optional "args"';M(e,r,{environment:u})}catch(e){}}function J(e,r,t){try{switch(u){case"client":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the client expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3||"object"!=typeof e)throw'triggerClient from the server expects 2 or 3 arguments: "player", "name", and optional "args"';break;case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the browser expects 1 or 2 arguments: "name", and optional "args"'}x(e,w,[r,t],{noRet:1})}catch(e){}}function V(e,r){try{if(arguments.length<1||arguments.length>2)throw'triggerServer expects 1 or 2 arguments: "name", and optional "args"';R(w,[e,r],{noRet:1})}catch(e){}}function q(e,r,t){try{switch(u){case"client":case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2)throw'triggerBrowsers from the client or browser expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3)throw'triggerBrowsers from the server expects 2 or 3 arguments: "player", "name", and optional "args"'}x(e,_,[r,t],{noRet:1})}catch(e){}}function U(e,r,t){try{if("client"!==u)throw"callBrowser can only be used in the client environment";if(arguments.length<2||arguments.length>4)throw'callBrowser expects 2 or 3 arguments: "browser", "name", and optional "args"';C(e,w,[r,t],{noRet:1})}catch(e){}}const I={register:k,unregister:B,call:P,callServer:j,callClient:O,callBrowsers:E,callBrowser:L,on:T,off:N,trigger:$,triggerServer:V,triggerClient:J,triggerBrowsers:q,triggerBrowser:U};return t})()}));